{% extends 'dashboard/layout.html' %}
{% load url from future %}
{% load i18n %}
{% load thumbnail %}
{% load staticfiles %}


{% block body_class %}create-page catalogue{% endblock %}

{% block title %}
    {{ title }} | {% trans "Product management" %} | {{ block.super }}
{% endblock %}

{% block breadcrumbs %}
    <ul class="breadcrumb">
        <li>
            <a href="{% url 'dashboard:index' %}">{% trans "Dashboard" %}</a>
            <span class="divider">/</span>
        </li>
        <li>
            <a href="{% url 'dashboard:catalogue-product-class-list' %}">{% trans "Product class management" %}</a>
            <span class="divider">/</span>
        </li>
        <li class="active">{{ title }}</li>

    </ul>
{% endblock %}

{% block headertext %}{{ title }}{% endblock %}

{% block dashboard_content %}
    <form action="{% if request.GET.urlencode %}?{{ request.GET.urlencode }}{% endif %}" method="post" class="form-stacked wysiwyg fixed-actions" enctype="multipart/form-data" data-behaviour="affix-nav-errors" autocomplete="off">
        {% csrf_token %}
        <div class="row-fluid">

            {% block tab_nav %}
                <div class="span3">
                    <div data-spy="affix" class="affix-top" data-offset-top="200">
                        <div class="table-header">
                            <h3>{% trans "Sections" %}</h3>
                        </div>
                        <ul class="nav nav-list bs-docs-sidenav" id="product_update_tabs">
                            <li class="active"><a href="#product_class_details" data-toggle="tab">{% trans 'Product class details' %}</a></li>
                            <li><a href="#product_attributes" data-toggle="tab">{% trans 'Attributes' %}</a></li>
                        </ul>
                    </div>
                </div>
            {% endblock tab_nav %}

            <div class="span9">
                <div class="tab-content">
                    {% block product_details %}
                        <div class="tab-pane {% if not product %}active{% endif %}" id="product_class_details">
                            <div class="table-header">
                                <h3>{% trans "Product Class Details" %}</h3>
                            </div>
                            <div class="well product-details">
                                {% block product_details_content %}
                                    <span class="help-block">{{ form.non_field_errors }}</span>
                                    {% for field in form %}
                                        {% if field.is_hidden %}
                                            {{ field }}
                                        {% endif %}
                                        {% if 'attr' not in field.id_for_label %}
                                            {% include "partials/form_field.html" with field=field %}
                                        {% endif %}
                                    {% endfor %}

                                    {% with parent=product.parent %}
                                        {% if parent %}
                                            <div class="control-group">
                                                <label class="control-label">{% trans "Parent" %}</label>
                                                <div class="controls">
                                                    <a href="{% url 'dashboard:catalogue-product' pk=parent.id %}" title="{% blocktrans %}Edit {{ parent.title }}{% endblocktrans %}">{{ parent.title }}</a>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endwith %}
                                {% endblock product_details_content %}
                            </div>
                        </div>
                    {% endblock product_details %}

                    {% block product_attributes %}
                        <div class="tab-pane" id="product_attributes">
                            {% block product_attributes_content %}
                                <table class="table table-striped table-bordered">
                                    <caption>
                                        {% trans "Product Attributes" %}  <span class="label label-success">{% trans "Product class:" %} {{ product_class }}</span>
                                    </caption>
                                    <tr>
                                        <th width="20%">{% trans "Attribute name" %}</th>
                                        <th>{% trans "Attribute option" %}</th>
                                    </tr>
                                    {% for field in form %}
                                        {% if 'attr' in field.id_for_label %}
                                            <tr>
                                                <td>
                                                    {{ field.label }}{% if field.field.required %} <span>*</span>{% endif %}
                                                </td>
                                                <td>
                                                    {% if field.is_hidden %}
                                                        {{ field }}
                                                    {% else %}
                                                        {{ field }}
                                                        {% for error in field.errors %}
                                                            <span class="help-block">
                                                                {{ error }}
                                                            </span>
                                                        {% endfor %}
                                                        {% if field.help_text %}
                                                            <span class='help-block'>
                                                                {{ field.help_text }}
                                                            </span>
                                                        {% endif %}
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                </table>
                            {% endblock product_attributes_content %}
                        </div>
                    {% endblock product_attributes %}
                </div>
            </div>
        </div>

        {% block fixed_actions_group %}
            <div class="fixed-actions-group">
                <div class="form-actions">
                    <div class="pull-right">
                        <a href="{% url 'dashboard:catalogue-product-list' %}">{% trans "Cancel" %}</a>
                        {% trans "or" %}
                        <button class="btn btn-secondary btn-large" name="action" type="submit" value="continue">{% trans "Save and continue editing" %}</button>
                        <button class="btn btn-primary btn-large" name="action" type="submit" value="save">{% trans "Save" %}</button>
                    </div>
                </div>
            </div>
        {% endblock fixed_actions_group %}
    </form>
{% endblock dashboard_content %}
